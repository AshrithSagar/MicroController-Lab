<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <title>Experiment-9 | MicroController-Lab</title>
    <link rel="stylesheet" href="/MicroController-Lab/static/style.css">
    
</head>

<body>
    

<h1>Experiment-9</h1>


<h2>E9_E1.ASM</h2>
<code>
    
    ; Interface the keypad and read the key-codes (HEX) of all keys.

    <br>
    
    ; Connect the keyboard to J2 of the trainer

    <br>
    
    ; Set the trainer in to KEYBOARD MODE

    <br>
    
    ; Configure Port A as Input and Port C as Output

    <br>
    
    

    <br>
    
    ; 8000H

    <br>
    
    BEGIN:

    <br>
    
    	MOV DPTR, #E803H 			; ADDRESS OF (J2) CONTROL REG

    <br>
    
    	; SET ALL PORTS AS INPUTS; PORT_A IN INPUT MODE

    <br>
    
    	MOV A, #90H 				; CONTROL CODE

    <br>
    
    	MOVX @DPTR, A 				; SET CONTROL REGISTER WITH THE CODE

    <br>
    
    	MOV A, #07H 				; TO SEND HIGH ON ALL ROWS

    <br>
    
    	DEC 82H 					; DEC DPTR

    <br>
    
    	MOVX @DPTR, A 				; WRITE TO PORT_B

    <br>
    
    	MOV 82H, #00H 				; GO TO PORT_A

    <br>
    
    

    <br>
    
    WAIT1:

    <br>
    
    	MOVX A, @DPTR 				; GET PORT_A INPUT TO ACCUMULATOR

    <br>
    
    	; CHECK ALL KEYS RELEASED?

    <br>
    
    	JNZ WAIT1 					; REPEAT UNTILL NON-ZERO INPUT GIVEN

    <br>
    
    	LCALL DBOUNCE 				; AWAIT DEBOUNCE KEYBOARD

    <br>
    
    

    <br>
    
    WAIT2:

    <br>
    
    	MOVX A, @DPTR 				; READ PORT_A FOR COLUMNS

    <br>
    
    	JZ WAIT2 					; CHECK ANY KEY PRESSED?

    <br>
    
    	LCALL DBOUNCE 				; AWAIT DEBOUNCE KEYBOARD

    <br>
    
    	MOV R0, #00H 				; INITIAL KEY CODE

    <br>
    
    	MOV R1, #03H 				; THE NUMBER OF ROWS

    <br>
    
    	MOV R2, #80H 				; TO SEND HIGH TO THE ROWS; INITIAL VALUE

    <br>
    
    

    <br>
    
    NXT_ROW:

    <br>
    
    	MOV DPTR, #E802H 			; ADDRESS OF PORT_C

    <br>
    
    	MOV A, R2 					; GET HIGH CODE TO ACCUMULATOR

    <br>
    
    	RL A 						; ROTATE LEFT TO GO TO THE NEXT ROW

    <br>
    
    	MOV R2, A 					; SAVE IN (R2)

    <br>
    
    	MOVX @DPTR, A 				; WRITE IN PORT_C

    <br>
    
    	MOV DPL, #00H 				; GO TO PORT_A

    <br>
    
    	MOVX A, @DPTR 				; GET PORT_A INPUT

    <br>
    
    	JNZ FOUND 					; 

    <br>
    
    	MOV A, R0 					;

    <br>
    
    	ADD A, #08H 				;

    <br>
    
    	MOV R0, A 					;

    <br>
    
    	DJNZ R1, NXT_ROW 			;

    <br>
    
    	LJMP BEGIN 					; EXIT AND BEGIN AGAIN

    <br>
    
    

    <br>
    
    FOUND:

    <br>
    
    	RRC A

    <br>
    
    	JC OVER

    <br>
    
    	INC R0

    <br>
    
    	SJMP FOUND

    <br>
    
    

    <br>
    
    OVER:

    <br>
    
    	MOV 60H, R0 				; DISPLAY PLACEHOLDER

    <br>
    
    	MOV F0H, #00H 				; NO DOT

    <br>
    
    	LCALL UPDDT 				; SHOW IN DISPLAY FIELD

    <br>
    
    	LJMP BEGIN 					; REPEAT ENTIRE PROGRAM AGAIN

    <br>
    
    

    <br>
    
    DBOUNCE:

    <br>
    
    	MOV TMOD, #10H 				; TIMER-1 IN MODE_1

    <br>
    
    	; DELAY OF 20ms

    <br>
    
    	MOV TH1, #B7H

    <br>
    
    	MOV TL1, #FFH

    <br>
    
    	SETB TR1 					; TIMER-1 SET

    <br>
    
    

    <br>
    
    HERE:

    <br>
    
    	JNB TF1, HERE 				; WAIT UNTIL TIMER-1 OVERFLOWS

    <br>
    
    	; RESET TIMER-1

    <br>
    
    	CLR TF1

    <br>
    
    	CLR TR1

    <br>
    
    	RET 						; RETURN BACK TO MAIN LOOP

    <br>
    
</code>

<h2>README.md</h2>
<code>
    
    # Calculator Keyboard Interface

    <br>
    
    

    <br>
    
    ## Examples

    <br>
    
    

    <br>
    
    1. Interface the keypad and read the key-codes (HEX) of all keys.

    <br>
    
    

    <br>
    
    ## Exercises

    <br>
    
    

    <br>
    
    1. Perform mathematical operations: ADD, MULTIPLY and SUBTRACT.

    <br>
    
    

    <br>
    
    2. Find the value of (X + Y) x Z - U (e. g. (5+4) x 3-7).

    <br>
    
</code>



</body>

</html>